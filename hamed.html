<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>جلسه ۱ • سطح ۱ — آکادمی هوش مصنوعی ستائی (۹ اسلاید)</title>
<style>
  :root{
    --bg1:#0b1020; --bg2:#071018;
    --text:#ecf3ff; --muted:rgba(236,243,255,.75);
    --accent:#10b981; --accent2:#34d399;
    --r:20px; --shadow:0 18px 60px rgba(0,0,0,.55);
    --maxw:980px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:"Vazirmatn",ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans Arabic",Arial;
    color:var(--text);
    background:
      radial-gradient(1100px 600px at 70% -10%, rgba(16,185,129,.20), transparent 60%),
      radial-gradient(900px 520px at 20% 0%, rgba(14,165,164,.12), transparent 60%),
      linear-gradient(180deg,var(--bg1),var(--bg2));
    overflow:hidden;
  }

  header{
    position:sticky; top:0; z-index:50;
    display:flex; gap:10px; align-items:center; justify-content:space-between;
    padding:10px 12px;
    background:rgba(8,12,22,.75);
    backdrop-filter: blur(12px);
    border-bottom:1px solid rgba(255,255,255,.08);
  }
  .brand{display:flex; align-items:center; gap:10px}
  .mark{
    width:34px; height:34px; border-radius:12px; display:grid; place-items:center;
    color:#062018; font-weight:1000;
    background:linear-gradient(135deg,var(--accent2),var(--accent));
    box-shadow:0 12px 30px rgba(16,185,129,.18)
  }
  .title{font-weight:1000; letter-spacing:-.2px}
  .sub{font-size:11px; color:rgba(236,243,255,.72); font-weight:850}

  .controls{display:flex; gap:8px; align-items:center}
  .btn{
    cursor:pointer; border-radius:14px; padding:10px 12px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(255,255,255,.04);
    color:var(--text);
    font-weight:900;
    white-space:nowrap;
  }
  .btn.primary{border:0; color:#062018; background:linear-gradient(135deg,var(--accent2),var(--accent))}
  .btn.ghost{background:rgba(255,255,255,.03)}
  .btn.small{padding:8px 10px; border-radius:12px; font-size:13px}
  .menu{position:relative}
  .menu > .panel{
    display:none; position:absolute; top:44px; left:0;
    min-width:210px; padding:8px;
    background:rgba(9,14,26,.92);
    border:1px solid rgba(255,255,255,.12);
    border-radius:14px;
    backdrop-filter:blur(10px);
    box-shadow: var(--shadow);
  }
  .menu.open > .panel{display:block}
  .panel .btn{width:100%; text-align:right}

  .stage{height:calc(100% - 120px); display:grid; place-items:center; padding:14px}
  .slide{
    width:min(var(--maxw), calc(100vw - 28px));
    max-height:calc(100vh - 165px);
    overflow:auto;
    padding:22px;
    border-radius:var(--r);
    border:1px solid rgba(255,255,255,.10);
    background:linear-gradient(180deg,rgba(255,255,255,.07),rgba(255,255,255,.03));
    box-shadow:var(--shadow);
    display:none;
    position:relative;
  }
  .slide.active{display:block}
  .slide::before{
    content:"";
    position:absolute; inset:-2px;
    background:radial-gradient(900px 420px at 72% 8%, rgba(16,185,129,.15), transparent 55%);
    pointer-events:none
  }
  .slide > *{position:relative}

  .eyebrow{
    display:inline-flex; gap:8px; align-items:center;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid rgba(52,211,153,.26);
    background:rgba(16,185,129,.12);
    font-size:12px; font-weight:950
  }
  h1,h2{margin:12px 0 10px; letter-spacing:-.35px}
  h1{font-size:clamp(26px,3.2vw,42px); line-height:1.15}
  h2{font-size:clamp(22px,2.3vw,32px); line-height:1.18}
  p{margin:0 0 10px; color:var(--muted); font-weight:850; font-size:17px}

  .grid{display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:10px}
  .box{
    border:1px solid rgba(255,255,255,.10);
    background:rgba(255,255,255,.04);
    border-radius:16px;
    padding:12px
  }
  .box h3{margin:0 0 8px; font-size:16px; letter-spacing:-.2px}
  ul{margin:8px 0 0; padding:0 18px 0 0; color:var(--muted); font-weight:850}
  li{margin:6px 0}

  .choices{display:grid; gap:10px; margin-top:12px}
  .choice{
    border:1px solid rgba(255,255,255,.12);
    background:rgba(255,255,255,.04);
    border-radius:14px;
    padding:12px;
    cursor:pointer;
    font-weight:900
  }
  .choice small{display:block; color:rgba(236,243,255,.66); margin-top:4px; font-weight:850}
  .choice:hover{border-color:rgba(52,211,153,.45)}

  .toolbar{display:flex; align-items:center; gap:8px; margin-top:10px; flex-wrap:wrap}
  .toggle{
    cursor:pointer;
    border:1px dashed rgba(255,255,255,.26);
    background:rgba(0,0,0,.14);
    color:var(--text);
    padding:8px 10px;
    font-weight:900;
    border-radius:12px
  }
  .script{
    margin-top:10px;
    border:1px dashed rgba(255,255,255,.20);
    background:rgba(0,0,0,.12);
    border-radius:16px;
    padding:12px;
    display:none
  }
  .script.on{display:block}
  .script .label{font-size:12px; color:rgba(236,243,255,.78); font-weight:1000; margin-bottom:6px}
  .script .line{color:rgba(236,243,255,.94); font-weight:900; line-height:1.9}

  .ico{width:26px; height:26px; margin-left:6px; vertical-align:-5px}
  .pillRow{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
  .pill{
    padding:7px 10px; border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(255,255,255,.03);
    color:rgba(236,243,255,.74);
    font-weight:900; font-size:12px;
  }
  .hr{height:1px; background:rgba(255,255,255,.08); margin:12px 0}

  textarea, input, select{
    width:100%;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.14);
    background:rgba(255,255,255,.03);
    color:var(--text);
    padding:12px;
    font-family: inherit;
    font-weight:850;
    outline:none;
  }
  textarea{min-height:120px; resize:vertical}
  .row{display:grid; grid-template-columns:1fr 1fr; gap:10px}
  .mono{
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    font-size:13px;
    line-height:1.6;
    white-space:pre-wrap;
    word-break:break-word;
  }
  .callout{
    border:1px solid rgba(52,211,153,.24);
    background:rgba(16,185,129,.10);
    border-radius:16px;
    padding:12px;
    color:rgba(236,243,255,.90);
    font-weight:900;
  }

  .modalBackdrop{
    position:fixed; inset:0;
    background:rgba(0,0,0,.55);
    display:none; place-items:center;
    z-index:999;
    padding:16px;
  }
  .modalBackdrop.on{display:grid}
  .modal{
    width:min(980px, 96vw);
    max-height:88vh;
    overflow:auto;
    border-radius:18px;
    border:1px solid rgba(255,255,255,.14);
    background:rgba(9,14,26,.92);
    backdrop-filter:blur(12px);
    box-shadow: var(--shadow);
    padding:14px;
  }
  .modalHead{display:flex; justify-content:space-between; gap:10px; align-items:center; margin-bottom:10px}
  .modalHead .h{font-weight:1000}
  .modalHead .x{border-radius:12px}

  footer{
    height:56px; display:flex; align-items:center; justify-content:space-between;
    padding:10px 12px;
    border-top:1px solid rgba(255,255,255,.08);
    background:rgba(0,0,0,.10)
  }
  .counter{font-size:13px; color:rgba(236,243,255,.72); font-weight:900; white-space:nowrap}
  .progress{height:10px; width:min(560px,58vw); background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10); border-radius:999px; overflow:hidden}
  .bar{height:100%; width:0%; background:linear-gradient(135deg,var(--accent2),var(--accent)); transition:width .2s}

  @media (max-width:860px){
    body{overflow:auto}
    .stage{height:auto; place-items:stretch}
    .slide{max-height:none; padding:18px}
    .grid{grid-template-columns:1fr}
    .row{grid-template-columns:1fr}
    .progress{display:none}
  }
</style>
</head>
<body>

<header>
  <div class="brand">
    <div class="mark">S</div>
    <div>
      <div class="title">جلسه ۱ • سطح ۱ — ۹ اسلاید</div>
      <div class="sub" id="miniSub">آکادمی هوش مصنوعی ستائی</div>
    </div>
  </div>
  <div class="controls">
    <button class="btn primary" onclick="prev()">قبلی</button>
    <button class="btn primary" onclick="next()">بعدی</button>
    <div class="menu" id="menu">
      <button class="btn ghost" onclick="toggleMenu()">⋯</button>
      <div class="panel">
        <button class="btn" onclick="restart(); toggleMenu(false)">شروع از اول</button>
        <button class="btn" onclick="toggleAllScripts(true); toggleMenu(false)">نمایش توضیحات استاد</button>
        <button class="btn" onclick="toggleAllScripts(false); toggleMenu(false)">پنهان کردن توضیحات</button>
        <button class="btn" onclick="toggleFullscreen(); toggleMenu(false)">تمام‌صفحه</button>
      </div>
    </div>
  </div>
</header>

<main class="stage">

  <!-- 1 -->
  <section class="slide active" id="s1" data-title="خوش آمدید">
    <div class="eyebrow">
      <svg class="ico" viewBox="0 0 24 24" fill="none"><path d="M5 21V4h10l-1.5 3H19l-1.5 3H19v8H5Z" stroke="currentColor" stroke-width="1.6"/></svg>
      شروع جلسه • سطح ۱
    </div>
    <h1>به دوره هوش مصنوعی خوش آمدید</h1>
    <p>امروز دنبال ابزارهای زیاد نیستیم. قرار است هوش مصنوعی برای شما تبدیل شود به یک «سیستم قابل اجرا» برای افزایش: درآمد، سرعت و نظم.</p>

    <div class="toolbar"><button class="toggle" onclick="toggleScript('s1')">راهنمای استاد</button></div>
    <div class="script" id="script-s1">
      <div class="label">هدف</div>
      <div class="line">«ابزار زیاد» نه؛ «سیستم ساده و قابل اجرا» بله.</div>
    </div>

    <div class="choices"><div class="choice" onclick="go('s2')">ادامه</div></div>
  </section>

  <!-- 2 -->
  <section class="slide" id="s2" data-title="این دوره دقیقاً چیست؟">
    <div class="eyebrow">
      <svg class="ico" viewBox="0 0 24 24" fill="none"><path d="M12 3c4.97 0 9 3.582 9 8 0 2.764-1.64 4.88-3.5 6.063L18 21l-4.5-2h-1C7.03 19 3 15.418 3 11s4.03-8 9-8Z" stroke="currentColor" stroke-width="1.6"/></svg>
      نگاه کلی
    </div>
    <h2>این دوره چه می‌کند؟</h2>
    <div class="grid">
      <div class="box">
        <h3>تعریف ساده</h3>
        <ul>
          <li>هوش مصنوعی = دستیار فکر و اجرا</li>
          <li>خروجی منظم، نه جواب شانسی</li>
          <li>روش ثابت برای کارهای تکراری</li>
        </ul>
      </div>
      <div class="box">
        <h3>قواعد ما</h3>
        <ul>
          <li>هر جلسه یک خروجی واقعی</li>
          <li>کم‌ابزار، پر‌نتیجه</li>
          <li>مسیر شخصی برای هر نفر</li>
        </ul>
      </div>
    </div>

    <div class="toolbar"><button class="toggle" onclick="toggleScript('s2')">راهنمای استاد</button></div>
    <div class="script" id="script-s2">
      <div class="label">متن پیشنهادی</div>
      <div class="line">«هوش مصنوعی موتور است؛ ما مسیر می‌سازیم تا موتور برایت نتیجه بده.»</div>
    </div>

    <div class="choices"><div class="choice" onclick="go('s3')">ادامه</div></div>
  </section>

  <!-- 3 -->
  <section class="slide" id="s3" data-title="هدف تو چیست؟">
    <div class="eyebrow">
      <svg class="ico" viewBox="0 0 24 24" fill="none"><path d="M12 21a9 9 0 1 1 0-18 9 9 0 0 1 0 18Z" stroke="currentColor" stroke-width="1.6"/><path d="M12 7v5l3 3" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
      تصمیم ۱
    </div>
    <h2>بعد از ۴ هفته چه چیزی باید تغییر کند؟</h2>
    <div class="choices">
      <div class="choice" onclick="select('goal','income'); go('s4')">درآمد <small>خروجی قابل فروش</small></div>
      <div class="choice" onclick="select('goal','speed'); go('s4')">سرعت <small>زمان کمتر، خروجی بیشتر</small></div>
      <div class="choice" onclick="select('goal','order'); go('s4')">نظم <small>روش ثابت و تکرارپذیر</small></div>
      <div class="choice" onclick="select('goal','all'); go('s4')">هر سه <small>اولویت‌گذاری می‌کنیم</small></div>
    </div>

    <div class="toolbar"><button class="toggle" onclick="toggleScript('s3')">راهنمای استاد</button></div>
    <div class="script" id="script-s3">
      <div class="label">نکته</div>
      <div class="line">اگر هر سه را گفت، یک اولویت اصلی انتخاب کنید.</div>
    </div>
  </section>

  <!-- 4 -->
  <section class="slide" id="s4" data-title="گره اصلی تو چیست؟">
    <div class="eyebrow">
      <svg class="ico" viewBox="0 0 24 24" fill="none"><path d="M10 3h4l1 4h4l-3 3 1 4-4-2-4 2 1-4-3-3h4l1-4Z" stroke="currentColor" stroke-width="1.6"/></svg>
      تصمیم ۲
    </div>
    <h2>الان بزرگ‌ترین گره‌ات کدام است؟</h2>
    <div class="choices">
      <div class="choice" onclick="select('problem','start'); go('s5')">شروع <small>شروع کردن سخت است</small></div>
      <div class="choice" onclick="select('problem','order'); go('s5')">نظم <small>ریتم کار ندارم</small></div>
      <div class="choice" onclick="select('problem','speed'); go('s5')">سرعت <small>زمان خیلی می‌برد</small></div>
      <div class="choice" onclick="select('problem','quality'); go('s5')">کیفیت <small>خروجی حرفه‌ای نیست</small></div>
    </div>

    <div class="toolbar"><button class="toggle" onclick="toggleScript('s4')">راهنمای استاد</button></div>
    <div class="script" id="script-s4">
      <div class="label">متن پیشنهادی</div>
      <div class="line">از اینجا به بعد نسخه شخصی ساخته می‌شود.</div>
    </div>
  </section>

  <!-- 5 -->
  <section class="slide" id="s5" data-title="نسخه پیشنهادی تو">
    <div class="eyebrow">
      <svg class="ico" viewBox="0 0 24 24" fill="none"><path d="M4 18V6h16v12H4Z" stroke="currentColor" stroke-width="1.6"/><path d="M8 10h8M8 14h5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
      نسخه پیشنهادی
    </div>
    <h2 id="plan-title">نسخه مناسب تو</h2>
    <div class="pillRow" id="summaryPills"></div>

    <div class="grid">
      <div class="box">
        <h3>قوانین این هفته</h3>
        <ul id="plan-laws"></ul>
      </div>
      <div class="box">
        <h3>نتیجه‌ای که می‌خواهیم</h3>
        <ul id="plan-result"></ul>
      </div>
    </div>

    <div class="toolbar"><button class="toggle" onclick="toggleScript('s5')">راهنمای استاد</button></div>
    <div class="script" id="script-s5">
      <div class="label">متن پیشنهادی</div>
      <div class="line" id="plan-coach">—</div>
    </div>

    <div class="choices"><div class="choice" onclick="go('s6')">ادامه</div></div>
  </section>

  <!-- 6 -->
  <section class="slide" id="s6" data-title="سه مرحله برای خروجی حرفه‌ای">
    <div class="eyebrow">
      <svg class="ico" viewBox="0 0 24 24" fill="none"><path d="M4 18h5V6H4v12Zm6 0h5V10h-5v8Zm6 0h4V4h-4v14Z" stroke="currentColor" stroke-width="1.6"/></svg>
      سیستم ستائی
    </div>
    <h2>سه مرحله که کیفیت می‌دهد</h2>
    <div class="grid">
      <div class="box">
        <h3>۱) طرح کلی</h3>
        <ul><li>تیترها و ترتیب بخش‌ها</li><li>قبل از نوشتن متن کامل</li></ul>
      </div>
      <div class="box">
        <h3>۲) پیش‌نویس سریع + ۳) اصلاح حرفه‌ای</h3>
        <ul><li>پیش‌نویس بدون وسواس</li><li>اصلاح با چک‌لیست</li></ul>
      </div>
    </div>

    <div class="toolbar"><button class="toggle" onclick="toggleScript('s6')">راهنمای استاد</button></div>
    <div class="script" id="script-s6">
      <div class="label">متن پیشنهادی</div>
      <div class="line">«اول نقشه، بعد ساخت، بعد پرداخت نهایی.»</div>
    </div>

    <div class="choices"><div class="choice" onclick="go('s7')">بریم دمو واقعی</div></div>
  </section>

  <!-- 7 -->
  <section class="slide" id="s7" data-title="دمو واقعی ورودی/خروجی">
    <div class="eyebrow">
      <svg class="ico" viewBox="0 0 24 24" fill="none"><path d="M12 2l3 7h7l-5.5 4 2 7-6.5-4-6.5 4 2-7L2 9h7l3-7Z" stroke="currentColor" stroke-width="1.6"/></svg>
      بخش عملی
    </div>

    <h2>یک ورودی بده → یک خروجی بگیر</h2>
    <p>اول استاد انجام می‌دهد، بعد دانشجو همان را تکرار می‌کند.</p>

    <div class="grid">
      <div class="box">
        <h3>نوع خروجی</h3>
        <select id="demoType" onchange="fillDemoTemplate()">
          <option value="content">تولید محتوا برای اینستاگرام</option>
          <option value="website">ساخت صفحه وب (لندینگ ساده)</option>
          <option value="support">ایده ایجنت پاسخ‌گو برای مشتری</option>
        </select>

        <div class="hr"></div>

        <h3>ورودی (موضوع واقعی)</h3>
        <textarea id="demoTopic" placeholder="مثال: من عکاسم و می‌خوام با محتوا مشتری بگیرم..."></textarea>

        <div class="toolbar">
          <button class="btn small" onclick="fillDemoTemplate()">قالب آماده</button>
          <button class="btn small" onclick="copyTextById('demoPrompt')">کپی متن برای چت‌جی‌پی‌تی</button>
        </div>
      </div>

      <div class="box">
        <h3>متن آماده برای ارسال به چت‌جی‌پی‌تی</h3>
        <div class="callout mono" id="demoPrompt"></div>
        <div class="hr"></div>
        <h3>خروجی مورد انتظار</h3>
        <ul>
          <li>طرح کلی</li>
          <li>پیش‌نویس سریع</li>
          <li>اصلاح با چک‌لیست</li>
        </ul>
      </div>
    </div>

    <div class="toolbar">
      <button class="toggle" onclick="toggleScript('s7')">راهنمای استاد</button>
      <button class="btn small ghost" onclick="openModal('checklist')">چک‌لیست اصلاح</button>
    </div>
    <div class="script" id="script-s7">
      <div class="label">روش</div>
      <div class="line">یک بار با هم اجرا کنید، سپس همان قالب را بدهید دانشجو خودش انجام دهد.</div>
    </div>

    <div class="choices"><div class="choice" onclick="go('s8')">ادامه</div></div>
  </section>

  <!-- 8 -->
  <section class="slide" id="s8" data-title="تکلیف + نقشه ۳ جلسه">
    <div class="eyebrow">
      <svg class="ico" viewBox="0 0 24 24" fill="none"><path d="M7 3h10v4H7V3Zm-2 6h14v12H5V9Z" stroke="currentColor" stroke-width="1.6"/></svg>
      مسیر ادامه
    </div>

    <h2>تا جلسه ۳، با دست خالی نمی‌مونی</h2>
    <div class="grid">
      <div class="box">
        <h3>جلسه ۱</h3>
        <ul><li>هدف/گره</li><li>سیستم ۳ مرحله‌ای</li><li>دمو و تکرار توسط دانشجو</li></ul>
      </div>
      <div class="box">
        <h3>جلسه ۲</h3>
        <ul><li>قالب‌های ثابت</li><li>نسخه‌گذاری و کیفیت</li><li>شروع ایجنت ساده</li></ul>
      </div>
    </div>
    <div class="box" style="margin-top:12px">
      <h3>جلسه ۳</h3>
      <ul><li>نهایی‌سازی ایجنت (FAQ + لید)</li><li>اتصال به هدف</li><li>برنامه ۳۰ روزه</li></ul>
    </div>

    <div class="hr"></div>

    <h3 style="margin:0 0 8px">تکلیف هفته اول</h3>
    <div class="grid">
      <div class="box">
        <h3>هر روز (۱۵ دقیقه)</h3>
        <ul><li>طرح کلی کوتاه</li><li>پیش‌نویس سریع</li></ul>
      </div>
      <div class="box">
        <h3>سه‌بار در هفته</h3>
        <ul><li>اصلاح با چک‌لیست</li><li>CTA دقیق</li></ul>
      </div>
    </div>

    <div class="choices"><div class="choice" onclick="go('s9')">پایان + نمونه ایجنت HTML</div></div>
  </section>

  <!-- 9 -->
  <section class="slide" id="s9" data-title="پایان + نمونه ایجنت HTML">
    <div class="eyebrow">
      <svg class="ico" viewBox="0 0 24 24" fill="none"><path d="M4 20V6h8l2 3h6v11H4Z" stroke="currentColor" stroke-width="1.6"/></svg>
      پایان بخش اول
    </div>

    <h2>جمع‌بندی کوتاه</h2>
    <ul>
      <li>هدف و گره اصلی مشخص شد</li>
      <li>نسخه مناسب تو تعیین شد</li>
      <li>سیستم سه‌مرحله‌ای را شناختی</li>
      <li>دمو انجام شد + تکلیف مشخص شد</li>
    </ul>

    <div class="hr"></div>

    <h3 style="margin:0 0 8px">نمونه ایجنت ساده با HTML</h3>
    <p>یک پاسخ‌گو خیلی ساده که سؤال‌های پرتکرار را جواب می‌دهد و در پایان اطلاعات تماس می‌گیرد.</p>

    <div class="choices">
      <div class="choice" onclick="openModal('agent')">نمایش دمو ایجنت</div>
      <div class="choice" onclick="openModal('code')">نمایش کد آماده (کپی)</div>
      <div class="choice" onclick="restart()">شروع دوباره</div>
    </div>
  </section>

</main>

<footer>
  <div class="counter" id="counter">اسلاید 1 / 9 • خوش آمدید</div>
  <div class="progress" aria-hidden="true"><div class="bar" id="bar"></div></div>
  <div class="counter">کلیدها: ←/→ یا Space • F</div>
</footer>

<!-- Modal -->
<div class="modalBackdrop" id="backdrop" onclick="backdropClose(event)">
  <div class="modal" role="dialog" aria-modal="true">
    <div class="modalHead">
      <div class="h" id="modalTitle">—</div>
      <button class="btn small x" onclick="closeModal()">بستن</button>
    </div>
    <div id="modalBody"></div>
  </div>
</div>

<script>
(function(){
  "use strict";

  // Core state
  const state = { goal:null, problem:null };

  // Elements
  const slides = Array.from(document.querySelectorAll('.slide'));
  const counter = document.getElementById('counter');
  const bar = document.getElementById('bar');
  const miniSub = document.getElementById('miniSub');
  const menu = document.getElementById('menu');
  const backdrop = document.getElementById('backdrop');
  const modalTitle = document.getElementById('modalTitle');
  const modalBody = document.getElementById('modalBody');

  // Helpers
  function activeIndex(){
    const i = slides.findIndex(s=>s.classList.contains('active'));
    return Math.max(0, i);
  }

  function updateUI(){
    const i = activeIndex();
    const t = slides[i].dataset.title || '';
    counter.textContent = `اسلاید ${i+1} / ${slides.length} • ${t}`;
    miniSub.textContent = t ? `اسلاید ${i+1}: ${t}` : 'آکادمی هوش مصنوعی ستائی';
    bar.style.width = Math.round((i)/(slides.length-1)*100) + '%';
  }

  function go(id){
    const el = document.getElementById(id);
    if(!el) return;
    slides.forEach(s=>s.classList.remove('active'));
    el.classList.add('active');
    history.replaceState(null,"",`#${id}`);
    updateUI();
    if(id==='s5') renderPlan();
    if(id==='s7') fillDemoTemplate();
  }

  // Public API (for inline onclick)
  window.go = go;
  window.next = function(){ const i = activeIndex(); if(i<slides.length-1) go(slides[i+1].id); };
  window.prev = function(){ const i = activeIndex(); if(i>0) go(slides[i-1].id); };
  window.restart = function(){ state.goal=null; state.problem=null; go('s1'); };

  window.select = function(key,val){ state[key]=val; };
  window.toggleScript = function(k){
    const el = document.getElementById(`script-${k}`);
    if(el) el.classList.toggle('on');
  };
  window.toggleAllScripts = function(show){
    document.querySelectorAll('.script').forEach(s => s.classList[show?'add':'remove']('on'));
  };

  // Menu
  window.toggleMenu = function(force){
    if(typeof force==='boolean'){ menu.classList.toggle('open', force); return; }
    menu.classList.toggle('open');
  };
  document.addEventListener('click', (e)=>{ if(!menu.contains(e.target)) menu.classList.remove('open'); });

  // Fullscreen
  window.toggleFullscreen = function(){
    if(!document.fullscreenElement){ document.documentElement.requestFullscreen?.(); }
    else{ document.exitFullscreen?.(); }
  };

  // Keyboard
  document.addEventListener('keydown', e=>{
    if(e.key==='ArrowRight' || e.key===' ' || e.key==='PageDown'){ e.preventDefault(); window.next(); }
    if(e.key==='ArrowLeft' || e.key==='PageUp'){ e.preventDefault(); window.prev(); }
    if(e.key.toLowerCase()==='f'){ window.toggleFullscreen(); }
    if(e.key==='Escape'){ menu.classList.remove('open'); closeModal(); }
  });

  // Slide 5 plan
  const planLaws = {
    start: ['خروجی ۱۵ دقیقه‌ای','قالب ثابت برای «طرح کلی»','شروع روزانه، بدون وسواس'],
    order: ['۱۵ دقیقه ثابت روزانه','یک سند ثابت برای همه خروجی‌ها','نسخه‌گذاری (۱ و ۲)'],
    speed: ['طرح کلی قبل از نوشتن','کاهش رفت‌وبرگشت با پرسش دقیق','چک‌لیست اصلاح سریع'],
    quality: ['چک‌لیست کیفیت ثابت','پیش‌نویس سریع سپس اصلاح','تعریف خط پایان روشن']
  };
  const planRes = {
    start: ['شروع بدون مقاومت','اعتمادبه‌نفس با خروجی‌های کوچک','جمع شدن خروجی در هفته'],
    order: ['ریتم پایدار','قابلیت پیگیری پیشرفت','کاهش آشفتگی'],
    speed: ['نسخه ۱ سریع‌تر','تصمیم‌های کمتر','تولید بیشتر'],
    quality: ['خروجی قابل ارائه','افزایش ارزش و قیمت‌گذاری','استاندارد حرفه‌ای']
  };
  const planCoach = {
    start:'«قرار نیست کامل شروع کنی؛ فقط شروع کوچک را استاندارد می‌کنیم.»',
    order:'«نظم یعنی سیستم ساده‌ای که انجام‌دادنش راحت‌تر از انجام‌ندادنش باشد.»',
    speed:'«سرعت از قالب و تصمیم‌های کمتر می‌آید؛ هر بار از صفر شروع نکن.»',
    quality:'«کیفیت با احساس سنجیده نمی‌شود؛ با چک‌لیست سنجیده می‌شود.»'
  };
  function goalLabel(v){ return {income:'درآمد', speed:'سرعت', order:'نظم', all:'هر سه'}[v] || ''; }
  function problemLabel(v){ return {start:'شروع', order:'نظم', speed:'سرعت', quality:'کیفیت'}[v] || ''; }
  function pill(text){
    const s=document.createElement('span');
    s.className='pill'; s.textContent=text;
    return s;
  }
  function renderPlan(){
    const p = state.problem || 'start';
    const g = state.goal || null;

    const title = document.getElementById('plan-title');
    const laws = document.getElementById('plan-laws');
    const res = document.getElementById('plan-result');
    const coach = document.getElementById('plan-coach');
    const pills = document.getElementById('summaryPills');

    if(title) title.textContent = 'نسخه مناسب تو — ' + problemLabel(p);
    if(laws) laws.innerHTML = (planLaws[p]||[]).map(x=>`<li>${x}</li>`).join('');
    if(res) res.innerHTML = (planRes[p]||[]).map(x=>`<li>${x}</li>`).join('');
    if(coach) coach.textContent = planCoach[p] || '—';

    if(pills){
      pills.innerHTML = '';
      if(g) pills.appendChild(pill('هدف: ' + goalLabel(g)));
      pills.appendChild(pill('گره: ' + problemLabel(p)));
    }
  }

  // Slide 7 demo prompt
  window.fillDemoTemplate = function(){
    const type = document.getElementById('demoType')?.value || 'content';
    const topic = (document.getElementById('demoTopic')?.value || '').trim();

    let task = '';
    if(type==='content') task = 'می‌خواهم یک محتوای اینستاگرامی بسازم که مشتری (لید) ایجاد کند.';
    else if(type==='website') task = 'می‌خواهم یک صفحه لندینگ ساده بسازم که کاربر را به تماس/رزرو هدایت کند.';
    else task = 'می‌خواهم یک پاسخ‌گوی ساده داشته باشم که سؤال‌های پرتکرار را جواب دهد و در پایان اطلاعات تماس بگیرد.';

    const prompt =
`تو یک دستیار حرفه‌ای برای تولید خروجی هستی.

وظیفه:
${task}

ورودی واقعی من:
${topic || 'موضوع/کسب‌وکار/هدف/مخاطب را اینجا بنویس.'}

قانون روش ستائی (حتماً رعایت کن):
۱) اول «طرح کلی» بده (۳ تا ۷ تیتر کوتاه)
۲) بعد «پیش‌نویس سریع» بده (کوتاه و بدون وسواس)
۳) بعد «اصلاح حرفه‌ای» انجام بده با این چک‌لیست:
- هدف روشن؟
- مخاطب مشخص؟
- یک مثال واقعی؟
- جمله اضافی حذف؟
- دعوت به اقدام (CTA) دقیق؟

خروجی را به همین ترتیب و با تیترهای واضح بنویس.`;

    const box = document.getElementById('demoPrompt');
    if(box) box.textContent = prompt;
  };

  window.copyTextById = function(id){
    const el = document.getElementById(id);
    const text = el?.textContent || el?.value || '';
    if(navigator.clipboard?.writeText) navigator.clipboard.writeText(text);
  };

  // Modal content builders
  function agentHtmlCode(){
return `<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ایجنت ساده • پاسخ‌گویی + لید</title>
<style>
  body{margin:0;font-family:Vazirmatn,system-ui;background:#0b1020;color:#ecf3ff}
  .wrap{max-width:820px;margin:24px auto;padding:16px}
  .card{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.10);border-radius:18px;padding:14px;margin-bottom:12px}
  h1{margin:0 0 10px;font-size:22px}
  p{margin:0 0 10px;color:rgba(236,243,255,.78);font-weight:800}
  select,input,textarea{width:100%;padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.04);color:#ecf3ff;font-family:inherit;font-weight:800;outline:none}
  textarea{min-height:110px;resize:vertical}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .btn{cursor:pointer;border-radius:14px;padding:10px 12px;border:0;background:linear-gradient(135deg,#34d399,#10b981);color:#062018;font-weight:1000}
  .ghost{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);color:#ecf3ff}
  .ans{padding:12px;border-radius:14px;border:1px solid rgba(52,211,153,.26);background:rgba(16,185,129,.10);font-weight:900;line-height:1.9}
  @media(max-width:720px){.row{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>ایجنت ساده (FAQ + دریافت لید)</h1>
    <p>این نسخه برای شروع است: چند سؤال پرتکرار را جواب می‌دهد و اگر کافی نبود، اطلاعات تماس می‌گیرد.</p>
  </div>

  <div class="card">
    <p><b>سؤال پرتکرار</b></p>
    <select id="q" onchange="render()">
      <option value="price">قیمت از کجا شروع می‌شود؟</option>
      <option value="time">چقدر زمان می‌برد؟</option>
      <option value="need">برای شروع چه چیزهایی لازم است؟</option>
      <option value="custom">سؤال من متفاوت است</option>
    </select>
    <div style="height:10px"></div>
    <div class="ans" id="a">—</div>
  </div>

  <div class="card">
    <p><b>اگر می‌خوای پیگیری کنیم (لید)</b></p>
    <div class="row">
      <input id="name" placeholder="نام" />
      <input id="phone" placeholder="شماره تماس" />
    </div>
    <div style="height:10px"></div>
    <textarea id="msg" placeholder="پیام کوتاه: چی می‌خوای بسازی؟ هدف چیه؟"></textarea>
    <div style="height:10px"></div>
    <div class="row">
      <button class="btn" onclick="save()">ثبت لید</button>
      <button class="btn ghost" onclick="prefill()">نمونه</button>
    </div>
    <p id="s" style="margin-top:10px"></p>
  </div>
</div>

<script>
  const answers = {
    price: 'از یک سطح پایه شروع می‌کنیم و با توجه به هدف شما نسخه دقیق پیشنهاد می‌شود. برای قیمت دقیق، یک پیام کوتاه از وضعیت فعلی لازم است.',
    time: 'برای نتیجه اولیه، همین هفته خروجی می‌گیرید. طی ۳ جلسه، سیستم شما تثبیت می‌شود و نمونه ابزار/ایجنت هم ساخته می‌شود.',
    need: 'فقط: هدف، مخاطب، نوع خروجی. باقی را قدم‌به‌قدم جلو می‌بریم.',
    custom: 'لطفاً پیام کوتاه بنویس: «چه چیزی می‌خواهی بسازی؟ مخاطب کیست؟ هدف دقیق چیست؟»'
  };

  function render(){
    const q = document.getElementById('q').value;
    document.getElementById('a').textContent = answers[q] || '—';
  }
  render();

  function prefill(){
    document.getElementById('name').value = 'حامد';
    document.getElementById('phone').value = '09xxxxxxxxx';
    document.getElementById('msg').value = 'می‌خوام یک صفحه ساده بسازم که لید بگیره و یک پاسخ‌گو برای سوال‌های پرتکرار داشته باشم.';
  }

  function save(){
    const name = document.getElementById('name').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const msg = document.getElementById('msg').value.trim();
    const s = document.getElementById('s');

    if(!name || !phone){ s.textContent = 'لطفاً نام و شماره را وارد کن.'; return; }

    const lead = {name, phone, msg, at: new Date().toISOString()};
    const key = 'leads';
    const arr = JSON.parse(localStorage.getItem(key) || '[]');
    arr.push(lead);
    localStorage.setItem(key, JSON.stringify(arr));

    s.textContent = 'ثبت شد (در مرورگر ذخیره شد).';
  }
<\/script>
</body>
</html>`;
  }

  window.openModal = function(kind){
    backdrop.classList.add('on');
    modalBody.innerHTML = '';

    if(kind==='checklist'){
      modalTitle.textContent = 'چک‌لیست اصلاح سریع';
      const div = document.createElement('div');
      div.className='box';
      div.innerHTML = `
        <h3>چک‌لیست اصلاح سریع</h3>
        <ul>
          <li>هدف خروجی روشن است؟ (یک جمله)</li>
          <li>مخاطب مشخص است؟</li>
          <li>یک مثال واقعی دارد؟</li>
          <li>جمله‌های اضافی حذف شده؟</li>
          <li>دعوت به اقدام (CTA) دقیق است؟</li>
        </ul>`;
      modalBody.appendChild(div);
      return;
    }

    if(kind==='agent'){
      modalTitle.textContent = 'دمو ایجنت ساده';
      const wrap = document.createElement('div');
      wrap.className='box';
      wrap.innerHTML = `
        <h3>سؤال پرتکرار</h3>
        <select id="faqQ">
          <option value="price">قیمت از کجا شروع می‌شود؟</option>
          <option value="time">چقدر زمان می‌برد؟</option>
          <option value="need">برای شروع چه چیزهایی لازم است؟</option>
          <option value="custom">سؤال من متفاوت است</option>
        </select>
        <div class="hr"></div>
        <div class="callout" id="faqA">—</div>
        <div class="hr"></div>
        <h3>دریافت لید</h3>
        <div class="row">
          <input id="lName" placeholder="نام" />
          <input id="lPhone" placeholder="شماره تماس" />
        </div>
        <textarea id="lMsg" style="margin-top:10px" placeholder="پیام کوتاه"></textarea>
        <div class="toolbar" style="margin-top:10px">
          <button class="btn small" onclick="prefillLead()">نمونه</button>
          <button class="btn small primary" onclick="saveLead()">ثبت (دمو)</button>
        </div>
        <div class="pillRow" id="lStatus" style="margin-top:10px"></div>
      `;
      modalBody.appendChild(wrap);

      const answers = {
        price:'از سطح پایه شروع می‌کنیم و با توجه به هدف شما نسخه دقیق پیشنهاد می‌شود. برای قیمت دقیق، یک پیام کوتاه لازم است.',
        time:'برای نتیجه اولیه، همین هفته خروجی می‌گیرید. طی ۳ جلسه، سیستم تثبیت می‌شود و ایجنت هم ساخته می‌شود.',
        need:'فقط: هدف، مخاطب، نوع خروجی. باقی را قدم‌به‌قدم جلو می‌بریم.',
        custom:'لطفاً پیام کوتاه بنویس: «چه چیزی می‌خواهی بسازی؟ مخاطب کیست؟ هدف چیست؟»'
      };

      const q = document.getElementById('faqQ');
      const a = document.getElementById('faqA');
      function render(){ a.textContent = answers[q.value] || '—'; }
      q.addEventListener('change', render);
      render();
      return;
    }

    if(kind==='code'){
      modalTitle.textContent = 'کد آماده ایجنت HTML';
      const div = document.createElement('div');
      div.className='box';
      div.innerHTML = `
        <div class="toolbar" style="margin-top:0">
          <button class="btn small" onclick="copyTextById('agentCode')">کپی کل کد</button>
        </div>
        <div class="callout mono" id="agentCode"></div>
      `;
      modalBody.appendChild(div);
      document.getElementById('agentCode').textContent = agentHtmlCode();
      return;
    }
  };

  window.closeModal = closeModal;
  function closeModal(){
    backdrop.classList.remove('on');
    modalBody.innerHTML = '';
  }
  window.backdropClose = function(e){ if(e.target === backdrop) closeModal(); };

  // Lead demo in modal
  window.prefillLead = function(){
    document.getElementById('lName').value='حامد';
    document.getElementById('lPhone').value='09xxxxxxxxx';
    document.getElementById('lMsg').value='می‌خوام یک صفحه ساده بسازم که لید بگیره و یک پاسخ‌گو برای سوال‌های پرتکرار داشته باشم.';
  };
  window.saveLead = function(){
    const n = document.getElementById('lName')?.value?.trim() || '';
    const p = document.getElementById('lPhone')?.value?.trim() || '';
    const m = document.getElementById('lMsg')?.value?.trim() || '';
    const st = document.getElementById('lStatus');
    if(!st) return;
    st.innerHTML='';
    if(!n || !p){ st.appendChild(pill('نام و شماره لازم است.')); return; }
    const key='setai_leads_demo';
    const arr=JSON.parse(localStorage.getItem(key)||'[]');
    arr.push({name:n, phone:p, msg:m, at:new Date().toISOString()});
    localStorage.setItem(key, JSON.stringify(arr));
    st.appendChild(pill('ثبت شد (دمو)'));
    st.appendChild(pill('ذخیره در مرورگر'));
  };

  // Init
  (function init(){
    const h = (location.hash || '').replace('#','');
    if(h && document.getElementById(h)) go(h);
    else updateUI();

    const activeId = slides[activeIndex()].id;
    if(activeId==='s5') renderPlan();
    if(activeId==='s7') fillDemoTemplate();
  })();

})();
</script>

</body>
</html>
